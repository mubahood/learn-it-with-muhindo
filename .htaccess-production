# Production .htaccess for ai-programming.tusometech.com

# Enable RewriteEngine
RewriteEngine On

# Force HTTPS
RewriteCond %{HTTPS} off
RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# Remove www (if applicable)
RewriteCond %{HTTP_HOST} ^www\.ai-programming\.tusometech\.com [NC]
RewriteRule ^(.*)$ https://ai-programming.tusometech.com/$1 [L,R=301]

# Default index file
DirectoryIndex index.php index.html

# Prevent directory browsing
Options -Indexes

# Protect sensitive files
<FilesMatch "^(config.*\.php|functions\.php|database\.sql|setup\.php|test.*\.php|.*\.log)$">
    Order Allow,Deny
    Deny from all
</FilesMatch>

# Allow access to enroll.php (AJAX endpoint)
<Files "enroll.php">
    Order Allow,Deny
    Allow from all
</Files>

# Allow access to admin.php
<Files "admin.php">
    Order Allow,Deny
    Allow from all
</Files>

# Allow access to index.php
<Files "index.php">
    Order Allow,Deny
    Allow from all
</Files>

# PHP security settings
php_flag display_errors off
php_flag log_errors on
php_value error_log error.log

# Prevent access to git files
<FilesMatch "^\.git">
    Order Allow,Deny
    Deny from all
</FilesMatch>

# Enable GZIP compression
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
</IfModule>

# Browser caching
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType image/jpg "access plus 1 year"
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
</IfModule>
